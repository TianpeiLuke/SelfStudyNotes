---
tags:
  - entry_point
  - project
  - buyer_seller_messaging
  - context_enhanced_bap
  - reversal_reclassification

aliases:
  - 0801bsmrnr00
date of note: 2024-02-28
name: BSM Reversal and Reclassification
author:
---
# Background

- [[RnR Background]]

Here are some main points for why RnR is proposed:

- Concession reason code plays an important role when identifying and measuring abuse in BAP. 
  
- Concession reasons are generated by different clients at different channels, each has authority to grant concession for a specific subset of orders. 
  
- Concession reason code does not accurately represent the concession event. 
	- Buyer or other agent who files the request did not know the correct reason code.
	- There is no direct match of pre-defined concession reason for the given event. 
	- The reason code as variable would be corrupted in the data ingestion.
	- The reason code may be processed to fit the needs of the client. 
	  
- Incorrect reason code would greatly damage BAP ability to detect abuse.
	- higher label noise in training set
	- corrupting risk variables, thus preventing the enforcement actions from taking place in future
	- lead to false positives in business metrics and dashboards.
	  
- **MFN Abuse Reversal and Re-classification (RnR)** aims at developing mechanisms that will enable us to systematically identify and eliminate the noise related to incorrect concession reason code in MFN space.
	- **Reversal** aims at reverse the abuse flag (from abuse to non-abuse) on given refund;
	- **Re-classification** aims at re-classify the abuse type associated with a given refund, or returns. 
	  
- In particular, the main goal is to use additional context from BSM to identify the events happened behind the scene. 

# Reversal Flag and Definitions

- [[RnR Flag Definitions]]
- [[RnR Flag Definitions Old]]

![[tag_decision_category.png]]
- Main Table for RnR flag and Deep dive
	- [[Table mfn_abuse_reversals]]
	- [[Table mfn_abuse_reversals ETL job]]
	- [[Table mfn_automate_rr_high_score ETL job]]

# Data

- Summary of RnR data sources:
	- [[RnR Data Source]]
- Offline Pipeline for data pulling, mode inference and storage in EDX:
	- [[RnR Data Pipeline]]

## Training Data ETL

- ETLM job and Cradle job to pull Training Data:
	- [[RnR Training Data ETL]]

## Training Data Analysis

- Understanding distribution of Features and Feature Engineering
	- [[RnR Training Data Analysis 1 Tabular Feature]]
	- [[RnR Training Data Analysis 2 Text]]

# Weak Supervision

- *Noisy Data Labeling* using **Programmatic Weak Supervision (PWS)**
	- [[RnR the Main Questions]]
	- [[RnR via Weak Supervision]]
	  
- Labeling Functions based on *feature engineering*, *NLP* and *LLM*
	- [[RnR Weak Labeling Functions]]
		- **Heuristic Rules** based on tabular features and existing models
			- WBR target
				- `abuse_flag`
				- `concession_type`
			- Buyer order and refund history
				- `net_conc_amt`
				- `ttm_conc_amt`
				- `ttm_conc_count`
				- `deliverable_flag`
				- `undeliverable_flag`
			- RnR queue categorization
				- `queued_type`
			- ML model scores (at order time)
				- `dnr_pmml_score_calibrated`
				- `notr_pmml_score_calibrated`
				- `bears_normal_prob`
				- `bears_risky_prob`
				- `bears_abuse_prob`
			- Seller flag:
				- `fb_seller_flag`
				- `seller_appeal_flag`
				- `seller_status`
			- Online queueing flag:
				- `pfw_queued`
				- `cap_flag`
				- `ri_flag`
				- `claim_interception_flag`
				- `rr_queued`
		- **Rules** based on *Meta Fields* and *Feature Engineering* on **BSM**:
			- Entry Point:
				- `ENTRY_POINT`
				- `risk_value_entry_point`
			- Topic Id:
				- `TOPIC_ID`
				- `risk_value_TOPIC_ID`
			- Seller Message Length:
				- `n_seller_message_count_by_order`
				- `risk_value_seller_message_count_by_order_bin`
			- Order Message Latency:
				- `day_order_msg_latency`
				- `risk_value_order_msg_latency_bin`
			- Thread Duration:
				- `day_msg_thread_duration_by_order`
				- `risk_value_msg_thread_duration_by_order_bin`
	- [[RnR Weak Labeling Functions Keyword Search]]
		- **Rules** based on *Verb Phrases* and *Name Entities*
	- [[RnR Weak Labeling Functions LLM]]
		- Prompt Tree in [[RnR Flag Definitions]]
		- **Prompt Engineering**
		- [[Amazon Bedrock Guide 02 Single Prompt Inference]]
	  
- Labeling Function Analysis and Label Model
	- [[RnR Weak Labeling Functions Analysis]]



# Application: Variable Correction

$$
\text{corrected SI} := \frac{C_A + C_M - (f_{s} \lor f_{r}) C_M }{O_A + O_M}
$$

where  

- $C_A$​ is *concession amount* for AFN;
- $C_M$​ is *concession amount* for AFN;
- $O_A$​ is order amount for AFN;
- $O_M$​ is order amount for MFN; 
- $f_s​ \in \{0,1\}$ is **seller fraud flag** “Normal” = 0, “Fraud” = 1
- $f_r​ \in \{0,1\}$ is **reversal flag** “non-reversal” = 0, “reversal” = 1

- For each abuse type (*NOTR, DIFF, Return, NSR, MDR, FLR*), the numerator values are conditioned on that abuse type.


-----------
##  Recommended Notes

- Check BSM data description, access, owner and pipeline in [[Buyer Seller Messaging (BSM) Entry Point]]
- Wiki for MFN RnR with BSM. [link](https://w.amazon.com/bin/view/AbusePrevention/Abuse_ML/BuyerAbuse_BuyerSellerMessaging/reversal_reclassification/)
- New label definition quip doc [RR tags- simplification](https://quip-amazon.com/SxaXAFQUffjr/RR-tags-simplification)
- Old label definition quip doc [RnR MFN investigations-2.0](https://quip-amazon.com/DOtwATY2nloB/RR-Reversal-and-Reclassification-MFN-Investigations-20)